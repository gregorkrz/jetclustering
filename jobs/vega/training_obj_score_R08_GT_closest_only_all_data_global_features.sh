#!/bin/bash
sbatch <<EOT
#!/bin/bash
#SBATCH --partition=gpu               # Specify the partition
#SBATCH --mem=25000                   # Request 10GB of memory
#SBATCH --time=48:00:00
#SBATCH --job-name=SVJTransformerTraining  # Name the job
#SBATCH --gres=gpu:1
#SBATCH --account=gpu_gres            # Specify the account
#SBATCH --output=jobs/vega/debug_train_obj_score_R20_mmed700_global_f.log
#SBATCH --error=jobs/vega/debug_train_err_obj_score_R20_mmed700_global_f.log

source env.sh
export APPTAINER_TMPDIR=/work/gkrzmanc/singularity_tmp
export APPTAINER_CACHEDIR=/work/gkrzmanc/singularity_cache
nvidia-smi

srun singularity exec -B /t3home/gkrzmanc/ -B /work/gkrzmanc/ -B /pnfs/psi.ch/cms/trivcat/store/user/gkrzmanc --nv docker://gkrz/lgatr:v3 python -m src.train  -train scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-1100_mDark-20_rinv-0.3_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-1500_mDark-20_rinv-0.3_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-1100_mDark-20_rinv-0.5_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-1500_mDark-20_rinv-0.5_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-1100_mDark-20_rinv-0.7_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-1500_mDark-20_rinv-0.7_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-1200_mDark-20_rinv-0.3_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-700_mDark-20_rinv-0.3_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-1200_mDark-20_rinv-0.5_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-700_mDark-20_rinv-0.5_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-1200_mDark-20_rinv-0.7_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-700_mDark-20_rinv-0.7_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-1300_mDark-20_rinv-0.3_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-800_mDark-20_rinv-0.3_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-1300_mDark-20_rinv-0.5_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-800_mDark-20_rinv-0.5_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-1300_mDark-20_rinv-0.7_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-800_mDark-20_rinv-0.7_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-1400_mDark-20_rinv-0.3_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-900_mDark-20_rinv-0.3_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-1400_mDark-20_rinv-0.5_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-900_mDark-20_rinv-0.5_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-1400_mDark-20_rinv-0.7_alpha-peak_13TeV-pythia8_n-2000 scouting_PFNano_signals2/SVJ_hadronic_std3/s-channel_mMed-900_mDark-20_rinv-0.7_alpha-peak_13TeV-pythia8_n-2000 -val scouting_PFNano_signals2/SVJ_hadronic_std2/s-channel_mMed-1000_mDark-20_rinv-0.3 scouting_PFNano_signals2/SVJ_hadronic_std2/s-channel_mMed-1500_mDark-20_rinv-0.5 scouting_PFNano_signals2/SVJ_hadronic_std2/s-channel_mMed-700_mDark-20_rinv-0.7 scouting_PFNano_signals2/SVJ_hadronic_std2/s-channel_mMed-900_mDark-20_rinv-0.3 scouting_PFNano_signals2/SVJ_hadronic_std2/s-channel_mMed-1000_mDark-20_rinv-0.5 scouting_PFNano_signals2/SVJ_hadronic_std2/s-channel_mMed-1500_mDark-20_rinv-0.7 scouting_PFNano_signals2/SVJ_hadronic_std2/s-channel_mMed-800_mDark-20_rinv-0.3 scouting_PFNano_signals2/SVJ_hadronic_std2/s-channel_mMed-900_mDark-20_rinv-0.5 scouting_PFNano_signals2/SVJ_hadronic_std2/s-channel_mMed-1000_mDark-20_rinv-0.7 scouting_PFNano_signals2/SVJ_hadronic_std2/s-channel_mMed-700_mDark-20_rinv-0.3 scouting_PFNano_signals2/SVJ_hadronic_std2/s-channel_mMed-800_mDark-20_rinv-0.5 scouting_PFNano_signals2/SVJ_hadronic_std2/s-channel_mMed-900_mDark-20_rinv-0.7 scouting_PFNano_signals2/SVJ_hadronic_std2/s-channel_mMed-1500_mDark-20_rinv-0.3 scouting_PFNano_signals2/SVJ_hadronic_std2/s-channel_mMed-700_mDark-20_rinv-0.5 scouting_PFNano_signals2/SVJ_hadronic_std2/s-channel_mMed-800_mDark-20_rinv-0.7  -net src/models/LGATr/lgatr.py -bs 128 --gpus 0 --run-name R08_LGATr_Obj_Score_all_data_GlobalFeatures --val-dataset-size 2000 --num-epochs 99999 --num-steps 300000 --attr-loss-weight 0.1 --coord-loss-weight 0.1 --beta-type pt+bc --spatial-part-only --gt-radius 0.8 --load-model-weights train/Train_LGATr_clustering_All_data_2025_02_15_16_15_07/step_42000_epoch_6.ckpt --lr-scheduler none --train-objectness-score --start-lr 1e-4 --num-workers 0 -obj-score-gt closest_only --global-features-obj-score

exit 0
EOT
